(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{290:function(a,s,t){"use strict";t.r(s);var e=t(14),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"环境搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#环境搭建"}},[a._v("#")]),a._v(" 环境搭建")]),a._v(" "),s("p",[a._v("默认地，giscat-server需要postgis数据库和11及以上版本的jdk。")]),a._v(" "),s("p",[a._v("（其实，postgis数据库并不是必须的，您只需要一个关系型数据库来存储giscat-server的配置信息，oracle、mysql甚至sqlite都可以，然后再有一个数据集插件来获取您的gis数据即可，但是建议您对giscat-server有一定的了解后再考虑做这些事。）")]),a._v(" "),s("h2",{attrs:{id:"安装postgis"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装postgis"}},[a._v("#")]),a._v(" 安装postgis")]),a._v(" "),s("p",[a._v("限于篇幅，本节使用docker安装，您也可以不用docker直接安装")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" /mydata/postgres/database_data\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" postgis "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /mydata/postgres/database_data:/var/lib/postgresql/data "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("POSTGRES_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("sde "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--publish")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"0.0.0.0:5432:5432"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--privileged")]),a._v(" postgis/postgis:13-3.3 \n\n")])])]),s("p",[a._v("这里，生成了一个用户名是postgres、密码是sde、端口是5432的postgis容器，并把容器内的pg数据存储目录映射到了宿主机的/mydata/postgres/database_data。")]),a._v(" "),s("h2",{attrs:{id:"导入示例配置和测试数据到postgis中"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#导入示例配置和测试数据到postgis中"}},[a._v("#")]),a._v(" 导入示例配置和测试数据到postgis中")]),a._v(" "),s("p",[s("a",{attrs:{href:"/assets/data/giscat_demo.zip"}},[a._v("点击这里")]),a._v("下载文件并解压，得到示例配置giscat_config.dump、测试数据giscat_testdata.dump。")]),a._v(" "),s("p",[a._v("拷贝dump到容器映射出来的路径，这样在容器内就能看到这两个dump")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" giscat_config.dump /mydata/postgres/database_data/\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" giscat_testdata.dump /mydata/postgres/database_data/\n")])])]),s("p",[a._v("进入容器并切换至postgres用户")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 进入容器")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" postgis "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 切换postgres用户")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("su")]),a._v(" postgres\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /var/lib/postgresql/data\n")])])]),s("p",[a._v("进入psql命令行，新建数据库giscat_config、giscat_testdata")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("psql\ncreate database giscat_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\ncreate database giscat_testdata"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exit")]),a._v("\n")])])]),s("p",[a._v("建库命令运行结果如下：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("postgres@b59bbdec8e03:~/data$ psql\npsql "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("13.10")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Debian "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("13.10")]),a._v("-1.pgdg110+1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("))")]),a._v("\nType "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"help"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" help.\n\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("postgres")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# create database giscat_config;")]),a._v("\nCREATE DATABASE\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("postgres")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# create database giscat_testdata;")]),a._v("\nCREATE DATABASE\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("postgres")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# exit")]),a._v("\npostgres@b59bbdec8e03:~/data$\n\n")])])]),s("p",[a._v("导入dump")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("psql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5432")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-U")]),a._v(" postgres giscat_config "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("./giscat_config.dump\npsql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5432")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-U")]),a._v(" postgres giscat_testdata "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("./giscat_testdata.dump\n")])])]),s("p",[a._v("导入完后就可以把两个dump文件删掉了。")]),a._v(" "),s("p",[a._v("至此，数据准备完毕，一路exit退出到宿主机即可。")]),a._v(" "),s("p",[a._v("注意，如果您为postgis设置的用户名、密码等不是默认的，请参考下列语句修改data_connect表")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 进入psql")]),a._v("\npsql\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 切到giscat_config库")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("c giscat_config\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 执行update语句")]),a._v("\nUPDATE public.data_connect\nSET config "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'{\n  "username": "postgres",\n  "password": "xxx",\n  "jdbcUrl": "jdbc:postgresql://localhost:5432/giscat_testdata",\n  "driverClassName": "org.postgresql.Driver",\n  "minimumIdle": 1,\n  "maximumPoolSize": 20\n}\n\'')]),a._v("\nWHERE "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("id")]),a._v(" LIKE "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'giscat_testdata'")]),a._v(" ESCAPE "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'#'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n")])])]),s("h2",{attrs:{id:"安装jdk11"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装jdk11"}},[a._v("#")]),a._v(" 安装jdk11")]),a._v(" "),s("p",[a._v("giscat-server需要11及以上版本的jdk才能运行，由于版权的原因，建议使用openjdk。")]),a._v(" "),s("p",[a._v("下载并解压缩openjdk11到指定目录")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://download.java.net/java/GA/jdk11/9/GPL/openjdk-11.0.2_linux-x64_bin.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-zxvf")]),a._v(" openjdk-11.0.2_linux-x64_bin.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" /mydata/java\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mv")]),a._v(" jdk-11.0.2 /mydata/java/\n")])])]),s("p",[a._v("配置环境变量，这步是可选的，如果您由于安装了其它版本jdk等原因而不想配环境变量，只需在启动时指定jdk11 java的绝对路径即可，例如"),s("code",[a._v("/mydata/java/jdk-11.0.2/bin/java -jar xxx")])]),a._v(" "),s("p",[s("code",[a._v("vi ~/.bashrc")]),a._v(",添加以下变量，注意不要写在第一行")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("JAVA_HOME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/mydata/java/jdk-11.0.2/\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("JAVA_BIN")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$JAVA_HOME")]),a._v("/bin\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("JAVA_LIB")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$JAVA_HOME")]),a._v("/lib\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CLASSPATH")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(".:"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$JAVA_LIB")]),a._v("/tools.jar:"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$JAVA_LIB")]),a._v("/dt.jar\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("PATH")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$JAVA_BIN")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$PATH")]),a._v("\n")])])]),s("p",[a._v(":wq "),s("code",[a._v("source ~/.bashrc")]),a._v("使得环境变量生效即可")]),a._v(" "),s("h2",{attrs:{id:"安装并启动giscat-server"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装并启动giscat-server"}},[a._v("#")]),a._v(" 安装并启动giscat-server")]),a._v(" "),s("p",[a._v("前往 https://github.com/codingmiao/giscat-server/releases/ 下载最新版的giscat-server.zip并解压到指定目录")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#下载zip文件，注意选择版本号")]),a._v("\nhttps://github.com/codingmiao/giscat-server/releases/download/1.0.0/giscat-server.zip\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("unzip")]),a._v(" giscat-server.zip\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" /mydata/japps\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mv")]),a._v(" giscat-server /mydata/japps/\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /mydata/japps/giscat-server/\n")])])]),s("p",[a._v("启动")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("java")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-jar")]),a._v(" giscat-server-main-1.0.0-STABLE.jar\n")])])]),s("p",[a._v("或直接后台运行,日志文件在logs目录下")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("nohup")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("java")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-jar")]),a._v(" giscat-server-main-1.0.0-STABLE.jar "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/dev/null "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("\n")])])]),s("p",[a._v("随便挑个接口curl测试一下是否能查出数据：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'http://localhost:12331/giscat-server/DataSet/giscat_testdata_test_polygon/Nearest?properties=id,name&x=101.5&y=20.4&n=3'")]),a._v("\n")])])]),s("p",[a._v("至此，本地环境已经跑起来了，下一节我们介绍如何导入数据、修改配置，这样我们就能在giscat-server中使用自己的业务数据生成的图层了。")])])}),[],!1,null,null,null);s.default=r.exports}}]);