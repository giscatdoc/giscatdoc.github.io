<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>示例数据与配置简介 | giscat doc</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="giscat 开发文档">
    
    <link rel="preload" href="/assets/css/0.styles.e8e4f3a3.css" as="style"><link rel="preload" href="/assets/js/app.00b2583e.js" as="script"><link rel="preload" href="/assets/js/2.733019b2.js" as="script"><link rel="preload" href="/assets/js/16.95a0d524.js" as="script"><link rel="prefetch" href="/assets/js/10.c4f3c725.js"><link rel="prefetch" href="/assets/js/11.8a584208.js"><link rel="prefetch" href="/assets/js/12.08d9a83f.js"><link rel="prefetch" href="/assets/js/13.95e6bf8e.js"><link rel="prefetch" href="/assets/js/14.10f1e084.js"><link rel="prefetch" href="/assets/js/15.fbe5a191.js"><link rel="prefetch" href="/assets/js/17.4dd90fd0.js"><link rel="prefetch" href="/assets/js/18.a552b8f4.js"><link rel="prefetch" href="/assets/js/19.95caf303.js"><link rel="prefetch" href="/assets/js/3.98f8877b.js"><link rel="prefetch" href="/assets/js/4.d12742be.js"><link rel="prefetch" href="/assets/js/5.216cae74.js"><link rel="prefetch" href="/assets/js/6.2d0a63f8.js"><link rel="prefetch" href="/assets/js/7.dadd7614.js"><link rel="prefetch" href="/assets/js/8.af3e87e8.js"><link rel="prefetch" href="/assets/js/9.330753d9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e8e4f3a3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.jpg" alt="giscat doc" class="logo"> <span class="site-name can-hide">giscat doc</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档" class="dropdown-title"><span class="title">文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="文档" class="mobile-dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/giscat-server/quickstart/" class="nav-link router-link-active">
  giscat-server
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="github" class="dropdown-title"><span class="title">github</span> <span class="arrow down"></span></button> <button type="button" aria-label="github" class="mobile-dropdown-title"><span class="title">github</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/codingmiao/giscat" target="_blank" rel="noopener noreferrer" class="nav-link external">
  giscat-server
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/codingmiao/giscat-server" target="_blank" rel="noopener noreferrer" class="nav-link external">
  giscat-tools
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档" class="dropdown-title"><span class="title">文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="文档" class="mobile-dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/giscat-server/quickstart/" class="nav-link router-link-active">
  giscat-server
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="github" class="dropdown-title"><span class="title">github</span> <span class="arrow down"></span></button> <button type="button" aria-label="github" class="mobile-dropdown-title"><span class="title">github</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/codingmiao/giscat" target="_blank" rel="noopener noreferrer" class="nav-link external">
  giscat-server
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/codingmiao/giscat-server" target="_blank" rel="noopener noreferrer" class="nav-link external">
  giscat-tools
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Home</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/giscat-server/quickstart/" class="sidebar-heading clickable router-link-active open"><span>giscat server</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/giscat-server/quickstart/" class="sidebar-heading clickable router-link-active open"><span>快速开始</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/giscat-server/quickstart/" aria-current="page" class="sidebar-link">接口示例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/giscat-server/quickstart/#查询名称为-云南省-的省" class="sidebar-link">查询名称为&quot;云南省&quot;的省：</a></li><li class="sidebar-sub-header"><a href="/giscat-server/quickstart/#查询距离点-101-5-20-4-最近的3个省" class="sidebar-link">查询距离点(101.5,20.4)最近的3个省：</a></li><li class="sidebar-sub-header"><a href="/giscat-server/quickstart/#输入一条线-查询这条线穿过哪些省" class="sidebar-link">输入一条线，查询这条线穿过哪些省：</a></li><li class="sidebar-sub-header"><a href="/giscat-server/quickstart/#构造一个矢量瓦片图层并在地图上显示" class="sidebar-link">构造一个矢量瓦片图层并在地图上显示：</a></li><li class="sidebar-sub-header"><a href="/giscat-server/quickstart/#小结" class="sidebar-link">小结</a></li></ul></li><li><a href="/giscat-server/quickstart/env.html" class="sidebar-link">环境搭建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/giscat-server/quickstart/env.html#安装postgis" class="sidebar-link">安装postgis</a></li><li class="sidebar-sub-header"><a href="/giscat-server/quickstart/env.html#导入示例配置和测试数据到postgis中" class="sidebar-link">导入示例配置和测试数据到postgis中</a></li><li class="sidebar-sub-header"><a href="/giscat-server/quickstart/env.html#安装jdk11" class="sidebar-link">安装jdk11</a></li><li class="sidebar-sub-header"><a href="/giscat-server/quickstart/env.html#安装并启动giscat-server" class="sidebar-link">安装并启动giscat-server</a></li></ul></li><li><a href="/giscat-server/quickstart/config-scan.html" aria-current="page" class="active sidebar-link">示例数据与配置简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/giscat-server/quickstart/config-scan.html#示例数据" class="sidebar-link">示例数据</a></li><li class="sidebar-sub-header"><a href="/giscat-server/quickstart/config-scan.html#配置" class="sidebar-link">配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/giscat-server/quickstart/config-scan.html#data-connect" class="sidebar-link">data_connect</a></li><li class="sidebar-sub-header"><a href="/giscat-server/quickstart/config-scan.html#data-set" class="sidebar-link">data_set</a></li><li class="sidebar-sub-header"><a href="/giscat-server/quickstart/config-scan.html#layer" class="sidebar-link">layer</a></li><li class="sidebar-sub-header"><a href="/giscat-server/quickstart/config-scan.html#layer-data-rule" class="sidebar-link">layerdatarule</a></li><li class="sidebar-sub-header"><a href="/giscat-server/quickstart/config-scan.html#map" class="sidebar-link">map</a></li><li class="sidebar-sub-header"><a href="/giscat-server/quickstart/config-scan.html#layer-in-map" class="sidebar-link">layerinmap</a></li><li class="sidebar-sub-header"><a href="/giscat-server/quickstart/config-scan.html#vector-tile-service" class="sidebar-link">vectortileservice</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>接口说明</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/giscat-server/plugin/" class="sidebar-heading clickable"><span>插件扩展</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="示例数据与配置简介"><a href="#示例数据与配置简介" class="header-anchor">#</a> 示例数据与配置简介</h1> <p>本小节介绍示例数据及配置信息是如何组织在一起的，在开始前，请先找一个数据库连接工具，比如Navicat或者DataGrip，连上前面的postgis，我们对照着表来说。</p> <h2 id="示例数据"><a href="#示例数据" class="header-anchor">#</a> 示例数据</h2> <p>giscat_testdata下有三张表，存放着示例数据：</p> <table><thead><tr><th>表名</th> <th>数据</th> <th>形状</th></tr></thead> <tbody><tr><td>test_point</td> <td>省会位置</td> <td>点</td></tr> <tr><td>test_line</td> <td>省边界</td> <td>线</td></tr> <tr><td>test_polygon</td> <td>省区域面</td> <td>面</td></tr></tbody></table> <p>每张表中都有一个shape字段，用以存储数据的形状。</p> <p>这些数据怎么来的的，首先，我们需要执行sql<code>create extension postgis</code>，在当前库中添加postgis扩展。随后，构造一张包含geometry类型字段的表：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> xxx
<span class="token punctuation">(</span>
    name  <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    shape <span class="token keyword">geometry</span><span class="token punctuation">(</span><span class="token keyword">linestring</span><span class="token punctuation">,</span><span class="token number">4326</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>其中，geometry(linestring,4326)的参数：</p> <p>linestring表示这个字段只能存线类型的geometry，不确定的话也可以笼统地写成geometry(geometry,4326)；</p> <p>4326表示其坐标系，即我们常说的经纬度坐标。</p> <p>最后往表中插入数据即可：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> xxx <span class="token punctuation">(</span>name<span class="token punctuation">,</span> shape<span class="token punctuation">)</span>
<span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'name0'</span><span class="token punctuation">,</span> st_geomfromtext<span class="token punctuation">(</span><span class="token string">'srid=4326;linestring(101.3 21.2,102.4 23.1)'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>linestring(101 21,102 23)</code>是一种几何对象的描述格式，叫做<a href="https://libgeos.org/specifications/wkt/" target="_blank" rel="noopener noreferrer">WKT<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>geometry字段也可以加上索引，有效地提高空间查询效率:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> xxx_geom_idx
    <span class="token keyword">ON</span> xxx
    <span class="token keyword">USING</span> GIST <span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="配置"><a href="#配置" class="header-anchor">#</a> 配置</h2> <p>在讲解配置表前，我们需要简单了解一下gis的基本对象模型：</p> <p><img src="/assets/img/gis-model.jpg" alt="gis对象基本模型示意"></p> <p>如图所示，以路况信息为例，
每条路是一个要素（feature），包含了道路位置（geometry）和路名、拥挤程度等属性(property);
所有道路构成道路图层(layer)；
把道路以及建筑、水系等图层添加到地图(map)，配上相应的展现样式，就完成了一幅地图的制作。</p> <p>而实际的系统建设中，feature的数量往往很大，我们需要一个数据库、文件之类的介质来存储和维护feature。
介质中的存储结构成为数据集（data-set），例如数据库中的一张表就是一个数据集；
而程序与介质连接的对象我们称为数据连接(data-connect)，例如jdbc中的java.sql.Connection对象就是一个数据连接。</p> <p>另外，在不同的地图<a href="https://blog.csdn.net/weixin_30367873/article/details/98045260" target="_blank" rel="noopener noreferrer">层级<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>下，layer中的feature可能会不一致，
比如一个道路图层，在层级7时只需显示道路的大致走向，我们从抽稀过坐标点的道路表查数据，而在层级14时需要展示精确的道路坐标信息，我们从道路原始表查数据，即可能会出现一个layer对应多个data-set的情况。
所以实际系统建设时，我们需要一个规则(layer-data-rule)来表达在什么层级去什么数据源以什么过滤条件查feature。</p> <p>所以，在giscat_config库中，设计了7张表来完成上述模型的存储和关联：</p> <table><thead><tr><th>表名</th> <th>存储配置</th> <th>对应模型</th></tr></thead> <tbody><tr><td>data_connect</td> <td>数据连接</td> <td>data-connect</td></tr> <tr><td>data_set</td> <td>数据集</td> <td>data-set</td></tr> <tr><td>layer</td> <td>图层</td> <td>layer</td></tr> <tr><td>layer_data_rule</td> <td>图层加载数据集的规则</td> <td>layer-data-rule</td></tr> <tr><td>map</td> <td>地图</td> <td>map</td></tr> <tr><td>layer_in_map</td> <td>地图包含哪些图层</td> <td>map</td></tr> <tr><td>vector_tile_service</td> <td>矢量瓦片服务配置</td> <td>服务</td></tr></tbody></table> <h3 id="data-connect"><a href="#data-connect" class="header-anchor">#</a> data_connect</h3> <p>data_connect中包含3个字段：</p> <p>id是其唯一id。</p> <p>loader数据连接加载器的类名，这里在进行插件开发时会详细说明，本示例中使用的是pg数据库的连接，所以填SqlDataConnectLoader即可。</p> <p>config是数据连接的配置信息，它是一个json对象，本示例中是一个标准的<a href="https://github.com/brettwooldridge/HikariCP#essentials" target="_blank" rel="noopener noreferrer">hikaricp连接池<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
配置信息：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;postgres&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;password&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sde&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;jdbcUrl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jdbc:postgresql://localhost:5432/giscat_testdata&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;driverClassName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;org.postgresql.Driver&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;minimumIdle&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;maximumPoolSize&quot;</span><span class="token operator">:</span> <span class="token number">20</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="data-set"><a href="#data-set" class="header-anchor">#</a> data_set</h3> <p>data_set中包含4个字段：</p> <p>id是其唯一id。</p> <p>loader数据集加载器的类名，这里在进行插件开发时会详细说明，本示例中使用的是postgis数据集，所以填PostgisDataSetLoader即可。</p> <p>data_connect_id是数据集依赖的数据连接的id。</p> <p>config是数据集的配置信息，它是一个json对象，本示例中，json里需要填写表名和表中geometry字段的字段名：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;tableName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test_polygon&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;shapeColumn&quot;</span><span class="token operator">:</span> <span class="token string">&quot;shape&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="layer"><a href="#layer" class="header-anchor">#</a> layer</h3> <p>layer中仅存放图层的唯一id。</p> <h3 id="layer-data-rule"><a href="#layer-data-rule" class="header-anchor">#</a> layer_data_rule</h3> <p>layer_data_rule与图层是多对一关系，包含6个字段：</p> <p>layer_id表示对哪个图层生效。</p> <p>min_zoom、max_zoom是规则生效的最小、最大<a href="https://blog.csdn.net/weixin_30367873/article/details/98045260" target="_blank" rel="noopener noreferrer">层级<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>,-1表示不限制。</p> <p>data_set_id表示去哪个数据集获取数据。</p> <p>expression是一个mapbox表达式，表示对数据集过滤的规则，为空则表示不进行过滤。</p> <p>order_num是一个优先级数值，如果在某个层级，一个图层有多个规则生效，则取order_num最小的那个规则。</p> <h3 id="map"><a href="#map" class="header-anchor">#</a> map</h3> <p>map中仅存放地图的唯一id。</p> <h3 id="layer-in-map"><a href="#layer-in-map" class="header-anchor">#</a> layer_in_map</h3> <p>layer_in_map与地图、与图层都是多对多关系，包含4个字段：</p> <p>map_id、layer_id共同决定了某个地图中包含哪些图层。</p> <p>layer_name表示图层在某个地图中的名称，为了防止传输中的各种奇怪问题，推荐名称配置为英文，在一个地图里，layer_name是唯一的。</p> <p>z_index是地图中图层的叠放顺序，z_index值越大的图层叠在越上层。</p> <h3 id="vector-tile-service"><a href="#vector-tile-service" class="header-anchor">#</a> vector_tile_service</h3> <p>vector_tile_service存放了矢量瓦片服务信息，或许在后续的版本里会新增其它扩展服务及对应配置表，vector_tile_service共3个字段：</p> <p>map_id是地图id，由于与map是一对一关系，所以这个字段也是唯一的。</p> <p>cache_time_out是瓦片缓存失效时间，单位毫秒,0表示不缓存、-1表示永不失效。</p> <p>layer_configs是一个key-value格式的json，key是地图中的图层name，value是此图层的瓦片配置参数，若某图层没配，则此图层所有参数取默认值：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;points&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;propertyNames&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token property">&quot;simplifyDistance&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token property">&quot;polygons&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;propertyNames&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token property">&quot;simplifyDistance&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其中propertyNames表示此图层瓦片需要取哪些属性，为空表示不取；</p> <p>simplifyDistance表示对图层中的geometry用道格拉斯-普克算法进行简化，单位是像素，例如一个面的坐标非常精细时，面中的点非常多，但在瓦片上人眼无法分辨这么精细，用这个参数简化能大幅提高性能。</p> <p>至此，所有数据介绍完毕，您可以愉快地往postgis中写入您的业务数据表，并修改配置表来完成您的GIS服务发布工作了~~~</p> <p>配置修改完后，需要重启一下服务，或者调用一下重新加载配置的接口才能使配置生效：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">curl</span> <span class="token string">'http://localhost:12331/giscat-server/Manage/ReloadConfig/100'</span>
</code></pre></div><p>加载配置接口对外暴露是非常危险的，为了防止不法分子利用此接口破坏系统稳定性，请务必在网关层将其屏蔽，例如在nginx上直接让它返回403。</p> <p>接下来，您可以阅读<a href="/giscat-server/api/">接口说明</a>章节来了解详细的接口功能和输入输出。</p> <p>如果默认的postgis数据连接、数据集无法满足您的业务需求，也可以阅读<a href="/giscat-server/plugin/">插件扩展</a>章节来编写一个适合您的插件。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/21/2023, 6:28:08 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/giscat-server/quickstart/env.html" class="prev">
        环境搭建
      </a></span> <span class="next"><a href="/giscat-server/api/">
        接口概述
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.00b2583e.js" defer></script><script src="/assets/js/2.733019b2.js" defer></script><script src="/assets/js/16.95a0d524.js" defer></script>
  </body>
</html>
